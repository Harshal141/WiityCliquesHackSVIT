<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoLabsUser</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <link href="../assets/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="main_style.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/2727ad4eb7.js" crossorigin="anonymous"></script>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top bg-light navbar-light shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#">
                <h1 class="h1 fw-bold">Co<span style=" color: var(--themePrimary)">Labs</span></h1>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent">
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <a class="nav-link mx-2" href="#!"><i class="fas fa-address-card pe-2"></i>Get Certified</a>
                    </li>
                    <li class="nav-item ms-3 rounded-pill">
                        <a class="btn btn-black btn-rounded rounded-pill text-light" href="index.html"
                            style="background-color: var(--themePrimary);">Log Out</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Navbar -->

    <!-- Profile -->
    <div id="profile" style="margin-top: 100px;" class="container-lg">
        <div class="row align-items-center">
            <div class="col-lg-4">
                <div class="card mb-4 border-light rounded-lg shadow-sm bg-light">
                    <div class="card-body text-center">
                        <img src="images/avatar.webp" alt="avatar" class="rounded-circle img-fluid shadow-sm"
                            style="width: 150px;">
                        <h5 class="my-3" id="name">Aakash Sharma </h5>
                        <p class="text-muted mb-1">First Year</p>
                        <p class="text-muted mb-4" id="edutype">Computer Engineering</p>
                    </div>
                </div>
            </div>

            <div class="col-lg-8">
                <div class="card mb-4 border rounded-lg border-light shadow-sm bg-light">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">College Name</p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0" id="clg">Army Institute of Technology, Pune</p>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Email</p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0" id="email">dahighsky@gmail.com</p>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Mobile</p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0" id="mbn">7340785879</p>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Address</p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0" id="address">Pune, Maharashtra, India</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- <div class="row flex-wrap">
                    <div class="col-3 d-flex justify-content-center"> <button class="btn btn-rounded rounded-pill center px-4 btn-outline-themePrimary"> Physics </button></div>
                    <div class="col-3 d-flex justify-content-center"> <button class="btn btn-rounded rounded-pill center px-4 btn-outline-themePrimary"> Electronics </button></div>
                    <div class="col-3 d-flex justify-content-center"> <button class="btn btn-rounded rounded-pill center px-4 btn-outline-themePrimary"> Mechanical </button></div>
                    <div class="col-3 d-flex justify-content-center"> <button class="btn btn-rounded rounded-pill center px-4 btn-outline-themePrimary"> Metallurgy </button></div>                    
                </div> -->
            </div>
        </div>
    </div>
    <!-- Profile -->

    <!-- Seach Section -->
    <div class="container-lg">
        <form class="locationSearch justify-content-around mt-4 row">
            <!-- Collapsible filters menu -->
            <div class="dropdown col-1">
                <button type="submit"
                    class="btn-outline-themePrimary p-3 rounded-pill bg-light shadow-sm dropdown-toggle"
                    data-bs-toggle="dropdown" style="width: 100%;">
                </button>

                <ul class="bg-themePrimary rounded-xl dropdown-menu">
                    <li><a class="dropdown-item text-light fw-bold" href="#">Filters</a></li>
                    <li><a class="dropdown-item text-light" href="#">Chemistry</a></li>
                    <li><a class="dropdown-item text-light" href="#">Physics</a></li>
                    <li><a class="dropdown-item text-light" href="#">Electronics</a></li>
                </ul>
            </div>
            <input type="text" placeholder="Search..." name="search" list="liss"
                class="bg-light col-8 p-3 rounded-pill border border-light shadow-sm search">
            <!-- suggestion -->
            <datalist id="liss">
                <option>3-D Printer</option>
                <option>CNC Machine</option>
                <option>Nuclear Reactor</option>
                <option>Telescope</option>
                <option>Laser</option>
                <option>Optics</option>
                <option>Mechanics</option>
            </datalist>
            <button type="submit" class="btn-themePrimary col-1 p-3 rounded-pill border border-0 shadow-sm sort">
                <i class="fas fa-search"></i>
            </button>
            <button type="submit" class="btn-themePrimary col-1 p-3 rounded-pill border border-0 shadow-sm">
                <i class="fas fa-map-pin"></i>
            </button>
        </form>
    </div>
    <!-- Search Section -->


    <br><br><br>


    <!-- Lab Recommendation -->
    <div class="album py-5 bg-light">
        <div class="container">
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3 mainBox">



            </div>
        </div>
    </div>
    <!-- Lab Recommendation -->

</body>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.7.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.7.0/firebase-analytics.js";
    import { getDatabase, ref, set, child, get } from "https://www.gstatic.com/firebasejs/9.7.0/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyAYfJLPdsZEJZBG4fe_iiC0zUt1rVmq3VU",
        authDomain: "wiitycliques.firebaseapp.com",
        databaseURL: "https://wiitycliques-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "wiitycliques",
        storageBucket: "wiitycliques.appspot.com",
        messagingSenderId: "728732831863",
        appId: "1:728732831863:web:dc65be187ff45aaf683672",
        measurementId: "G-2ZCS2MP69G"
    };

    // firebase data for main details
    document.getElementById('name').innerHTML = localStorage.getItem("name")
    document.getElementById('clg').innerHTML = localStorage.getItem("college")
    document.getElementById('email').innerHTML = localStorage.getItem("email")
    document.getElementById('mbn').innerHTML = localStorage.getItem("phone")
    document.getElementById('address').innerHTML = localStorage.getItem("address")
    // document.getElementById('namee').
    // document.getElementById('namee').
    // document.getElementById('namee').

    // sort after clicking function
    document.querySelector('.sort').addEventListener("click", function (e) {
        console.log("run")
        e.preventDefault()

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getDatabase(app)
        const dbRef = ref(db)
        let data;
        get(child(dbRef, `college/`)).then((snapshot) => {
            if (snapshot.exists()) {
                // retrieve data from search bar
                let search = document.querySelector(".search").value
                document.querySelector('.search').value = "";
                console.log(search)
                for (let i = 0; i < Object.keys(snapshot.val()).length; i++) {
                    // data print
                    let name = snapshot.val()[i + 1]
                    let x = name.location.split(",")[0], y = name.location.split(",")[1]
                    let dist;
                    if (name.category.includes(search,)) {
                        printLab(i + 1, name, dist)
                    }
                }
            } else {
                console.log("No data available");
            }
        }).catch((error) => {
            console.error(error);
        });
    })

    // event to open comp
    let box = document.querySelector(".mainBox")
    box.addEventListener("click", function real(e) {
        if (e.target.className == "btn btn-sm btn-outline-secondary view") {
            let id = e.target.nextElementSibling.innerHTML
            window.localStorage.setItem('id', id);
            window.open("comp.html", '_blank');
        }
    })

    // print function
    function printLab(sr_no, name, dist) {
        let box = document.querySelector(".mainBox")
        box.innerHTML += `   <div class="col rounded-xl">
                    <div class="card shadow-sm rounded-xl">
                        <img src=${name.image} class="bd-placeholder-img card-img-top rounded-lg" width="100%"
                            height="225" focusable="false">
                        <title>Placeholder</title></img>

                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h3 class="h4">${name.labName}</h3>
                                    <h4 class="h5">${name.college}</h4>
                                </div>
                                <div class="btn btn-themePrimary rounded-circle shadow-sm"
                                    style="height: 50px; width: 50px;">
                                    <i class="fas fa-map-pin mt-2"></i>
                                </div>
                            </div>
                            <br>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">${dist} Km</small>
                                <small class="text-muted">$ ${name.price}</small>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-sm btn-outline-secondary view">View</button>
                                    <p style="display:none;">${sr_no}</p>
                                    <button onclick="document.location='${name.gateway}'" type="button" class="btn btn-sm btn-outline-secondary book">Book Slot</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            `;
    }

</script>


get(child(dbRef, `users/`)).then((snapshot) => {
    if (snapshot.exists()) {
        let loop = 0
        for (const key in snapshot.val()) {
            if(key == localStorage.getItem("uid")){
                loop = 1
        }}
            if(loop == 1){
                location.replace("main.html")
            }else{
                location.replace("details.html")
            }
        
        // console.log(snapshot.val());
    } else {
        console.log("No data available");
    }
}).catch((error) => {
    console.error(error);
});
</html>